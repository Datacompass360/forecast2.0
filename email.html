<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataCompass 360 - App</title>
    
    <!-- Favicon Placeholder -->
    <link rel="icon" href="https://icon.horse/icon/compass.com" type="image/png">

    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- 3. Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- 4. Papaparse (for CSV parsing) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js" xintegrity="sha512-dfHqHJzVobijUe9PaS9paL8hL8LqIe/K6b/2EDuJcYNK3s/9hG0/s/1/2QotSVvL/hmd1S2M91V/fFhB7M0j7w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- 5. Custom Tailwind Configuration & Styles -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'navy': '#001f3f',
                        'emerald': '#00A86B',
                        'gold': '#FFD700',
                        'light-gray': '#f0f4f8',
                    },
                    fontFamily: {
                        'sans': ['Poppins', 'sans-serif'],
                        'body': ['Roboto', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f0f4f8;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', 'sans-serif';
        }
        /* Style for active nav tab */
        .nav-tab-button.active {
            background-color: #00A86B; /* Emerald */
            color: white;
            font-weight: 600;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1ff; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #00A86B; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #007a4e; }
        
        /* Simple CSS Loader */
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #00A86B;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Ensure table layout is consistent */
        table {
            table-layout: fixed;
            width: 100%;
        }
        
        /* Set specific column widths for readability */
        /* Table 1: Frequent Winners (9 columns) */
        #frequent-winners-table th:nth-child(1) { width: 10%; } /* Confidence % */
        #frequent-winners-table th:nth-child(2) { width: 13%; } /* Prediction */
        #frequent-winners-table th:nth-child(3) { width: 13%; } /* Predicted Outcome */
        #frequent-winners-table th:nth-child(4) { width: 10%; } /* Match Result */
        #frequent-winners-table th:nth-child(5) { width: 14%; } /* Home Team */
        #frequent-winners-table th:nth-child(6) { width: 14%; } /* Away Team */
        #frequent-winners-table th:nth-child(7) { width: 12%; } /* Predicted Prob (%) */
        #frequent-winners-table th:nth-child(8) { width: 12%; } /* Expected Outcome */
        #frequent-winners-table th:nth-child(9) { width: 12%; } /* Probability */

        /* Table 2: Over 2.5 (14 columns) */
        #over-2-5-table th:nth-child(1) { width: 7%; } /* H Avg S */
        #over-2-5-table th:nth-child(2) { width: 7%; } /* H Avg C */
        #over-2-5-table th:nth-child(3) { width: 7%; } /* A Avg S */
        #over-2-5-table th:nth-child(4) { width: 7%; } /* A Avg C */
        #over-2-5-table th:nth-child(5) { width: 12%; } /* Home Team */
        #over-2-5-table th:nth-child(6) { width: 12%; } /* Away Team */
        #over-2-5-table th:nth-child(7) { width: 7%; } /* Conf % */
        #over-2-5-table th:nth-child(8) { width: 8%; } /* Prediction */
        #over-2-5-table th:nth-child(9) { width: 7%; } /* Pred Out */
        #over-2-5-table th:nth-child(10) { width: 7%; } /* Pred Prob */
        #over-2-5-table th:nth-child(11) { width: 7%; } /* Result */
        #over-2-5-table th:nth-child(12) { width: 7%; } /* Exp Out */
        #over-2-5-table th:nth-child(13) { width: 7%; } /* Prob */
        #over-2-5-table th:nth-child(14) { width: 7%; } /* Total Goals */

        /* Table: Senders */
        #senders-table-body th:nth-child(1) { width: 15%; } /* Status */
        #senders-table-body th:nth-child(2) { width: 30%; } /* Email */
        #senders-table-body th:nth-child(3) { width: 25%; } /* Name */
        #senders-table-body th:nth-child(4) { width: 15%; } /* Type */
        #senders-table-body th:nth-child(5) { width: 15%; } /* Actions */

        /* Table: Scheduling */
        #scheduling-table-body th:nth-child(1) { width: 15%; } /* Status */
        #scheduling-table-body th:nth-child(2) { width: 25%; } /* Subject */
        #scheduling-table-body th:nth-child(3) { width: 20%; } /* Recipients */
        #scheduling-table-body th:nth-child(4) { width: 15%; } /* Recurrence */
        #scheduling-table-body th:nth-child(5) { width: 15%; } /* Next Send */
        #scheduling-table-body th:nth-child(6) { width: 10%; } /* Actions */
    </style>
</head>
<body class="bg-gray-100">

    <!-- =================================================================== -->
    <!-- NOTIFICATION POPUP (Replaces alert())                               -->
    <!-- =================================================================== -->
    <div id="notification-popup" class="hidden fixed top-5 right-5 z-[100] p-4 rounded-lg shadow-lg text-white transition-all duration-300 max-w-sm">
        <span id="notification-message"></span>
    </div>

    <!-- =================================================================== -->
    <!-- MAIN APPLICATION WRAPPER                                            -->
    <!-- =================================================================== -->
    <div class="h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-navy text-white shadow-lg flex items-center justify-between px-6 py-3 z-10">
            <div class="flex items-center space-x-3">
                <!-- Logo -->
                <div class="p-2 rounded-full bg-white">
                    <svg class="w-8 h-8 text-navy" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"></path>
                        <polygon points="12 4 14 8 12 10 10 8" class="text-gold" fill="currentColor"></polygon>
                    </svg>
                </div>
                <h1 class="text-2xl font-bold">DataCompass 360</h1>
            </div>
            
            <!-- User Menu (Placeholder) -->
            <div class="flex items-center space-x-4">
                <div class="text-right">
                    <div class="text-sm text-gray-300">Welcome,</div>
                    <div id="user-email" class="font-medium">Admin User</div>
                </div>
                <div class="w-10 h-10 rounded-full bg-emerald flex items-center justify-center font-bold">A</div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="flex flex-1 overflow-hidden">
            <!-- Navigation Sidebar -->
            <nav class="w-64 bg-navy text-gray-300 flex-shrink-0 p-4 space-y-2 overflow-y-auto">
                <!-- Link to index.html (if it exists) or reload -->
                <a href="#" onclick="window.location.reload();" class="nav-tab-button w-full flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition duration-200" data-tab="hot-picks">
                    <i class="fas fa-fire-alt h-5 w-5 text-center"></i>
                    <span class="ml-0.5">ðŸ”¥ Hot Picks</span>
                </a>
                
                <!-- Merged Tab Navigation -->
                <button class="nav-tab-button w-full flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition duration-200" data-tab="email-management">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2" />
                    </svg>
                    <span>Sender Management</span>
                </button>
                <button class="nav-tab-button w-full flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition duration-200" data-tab="email-scheduling">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span>Email Scheduling</span>
                </button>
                <button class="nav-tab-button w-full flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition duration-200" data-tab="report-designer">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <span>Report Designer</span>
                </button>
            </nav>

            <!-- Content Area -->
            <main class="flex-1 overflow-y-auto bg-gray-100 p-6">
                
                <!-- 
                  =======================
                  TAB: Hot Picks (Merged)
                  ======================= 
                -->
                <div id="hot-picks-tab" class="tab-content">
                    <div class="flex justify-between items-center mb-4">
                        <h1 class="text-3xl font-bold text-navy">ðŸ”¥ Hot Picks</h1>
                         <div class="flex items-center space-x-2">
                            <span class="text-sm font-medium text-gray-700">Legend:</span>
                            <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                Total Goals â‰¥ 3
                            </span>
                        </div>
                    </div>
                   
                    <!-- Table 1: Frequent Winners -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-xl font-semibold text-navy">Teams: Frequent Winners ( >3 Apps, â‰¥3 Wins)</h2>
                            <p class="text-sm text-gray-600">Shows all matches for teams that meet the criteria.</p>
                        </div>
                        
                        <!-- Filters for Table 1 -->
                        <div class="p-4 grid grid-cols-1 md:grid-cols-3 gap-4 bg-gray-50">
                            <div>
                                <label for="date-filter-1" class="block text-sm font-medium text-gray-700">Filter by Date</label>
                                <select id="date-filter-1" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald">
                                    <option value="">All Dates</option>
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                            <div>
                                <label for="league-filter-1" class="block text-sm font-medium text-gray-700">Filter by League</label>
                                <select id="league-filter-1" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald">
                                    <option value="">All Leagues</option>
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                        </div>
                        
                        <!-- Table 1 Wrapper -->
                        <div id="table-1-loader" class="loader"></div>
                        <div id="table-1-wrapper" class="overflow-x-auto hidden">
                            <table id="frequent-winners-table" class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <!-- Updated Headers -->
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Confidence %</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prediction</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Predicted Outcome</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Match Result</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Home Team</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Away Team</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Predicted Prob (%)</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Expected Outcome</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Probability</th>
                                    </tr>
                                </thead>
                                <tbody id="frequent-winners-tbody" class="bg-white divide-y divide-gray-200">
                                    <!-- Rows populated by JS -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Pagination for Table 1 -->
                        <div id="pagination-1" class="px-6 py-3 border-t border-gray-200 flex items-center justify-between">
                            <button id="prev-btn-1" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 transition font-medium disabled:opacity-50 disabled:cursor-not-allowed">
                                <i class="fas fa-arrow-left mr-2"></i>Previous
                            </button>
                            <span id="page-info-1" class="text-sm text-gray-700">Page 1 of 1</span>
                            <button id="next-btn-1" class="px-4 py-2 bg-emerald text-white rounded-lg hover:bg-opacity-90 transition font-medium disabled:opacity-50 disabled:cursor-not-allowed">
                                Next<i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Table 2: Over 2.5 Prediction -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h2 class="text-xl font-semibold text-navy">Over 2.5 Prediction (H/A Scored â‰¥1.8, H/A Conceded â‰¥1.5)</h2>
                            <p class="text-sm text-gray-600">Shows matches where both teams have high offensive and defensive stats.</p>
                        </div>
                        
                        <!-- Filters for Table 2 -->
                        <div class="p-4 grid grid-cols-1 md:grid-cols-3 gap-4 bg-gray-50">
                            <div>
                                <label for="date-filter-2" class="block text-sm font-medium text-gray-700">Filter by Date</label>
                                <select id="date-filter-2" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald">
                                    <option value="">All Dates</option>
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                            <div>
                                <label for="league-filter-2" class="block text-sm font-medium text-gray-700">Filter by League</label>
                                <select id="league-filter-2" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald">
                                    <option value="">All Leagues</option>
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                        </div>
                        
                        <!-- Table 2 Wrapper -->
                        <div id="table-2-loader" class="loader"></div>
                        <div id="table-2-wrapper" class="overflow-x-auto hidden">
                            <table id="over-2-5-table" class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <!-- Updated Headers -->
                                        <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">H Avg S</th>
                                        <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">H Avg C</th>
                                        <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">A Avg S</th>
                                        <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">A Avg C</th>
                                        <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Home Team</th>
                                        <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Away Team</th>
                                        <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Conf %</th>
                                        <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prediction</th>
                                        <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pred Out</th>
                                        <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pred Prob %</th>
                                        <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Result</th>
                                        <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Exp Out</th>
                                        <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prob</th>
                                        <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Goals</th>
                                    </tr>
                                </thead>
                                <tbody id="over-2-5-tbody" class="bg-white divide-y divide-gray-200">
                                    <!-- Rows populated by JS -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Pagination for Table 2 -->
                        <div id="pagination-2" class="px-6 py-3 border-t border-gray-200 flex items-center justify-between">
                            <button id="prev-btn-2" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 transition font-medium disabled:opacity-50 disabled:cursor-not-allowed">
                                <i class="fas fa-arrow-left mr-2"></i>Previous
                            </button>
                            <span id="page-info-2" class="text-sm text-gray-700">Page 1 of 1</span>
                            <button id="next-btn-2" class="px-4 py-2 bg-emerald text-white rounded-lg hover:bg-opacity-90 transition font-medium disabled:opacity-50 disabled:cursor-not-allowed">
                                Next<i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 
                  =======================
                  TAB: Email Management (Merged)
                  ======================= 
                -->
                <div id="email-management-tab" class="tab-content hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-3xl font-bold text-navy">Sender Email Management</h1>
                        <button id="add-email-btn" class="px-5 py-2 bg-emerald text-white rounded-lg font-semibold shadow-md hover:bg-opacity-90 transition">
                            <i class="fas fa-plus mr-2"></i>Add New Sender
                        </button>
                    </div>

                    <!-- Configured Senders Table -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email Address</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Display Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="senders-table-body" class="bg-white divide-y divide-gray-200">
                                    <!-- Populated by Firebase -->
                                    <tr>
                                        <td colspan="5" class="px-6 py-4 text-center text-gray-500">Loading senders...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 
                  =======================
                  TAB: Email Scheduling (Merged)
                  ======================= 
                -->
                <div id="email-scheduling-tab" class="tab-content hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-3xl font-bold text-navy">Email Scheduling</h1>
                        <button id="schedule-email-btn" class="px-5 py-2 bg-emerald text-white rounded-lg font-semibold shadow-md hover:bg-opacity-90 transition">
                            <i class="fas fa-plus mr-2"></i>Schedule New Email
                        </button>
                    </div>

                    <!-- Scheduled Emails Table -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subject</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Recipients</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Recurrence</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Next Send</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="scheduling-table-body" class="bg-white divide-y divide-gray-200">
                                    <!-- Populated by Firebase -->
                                    <tr>
                                        <td colspan="6" class="px-6 py-4 text-center text-gray-500">Loading scheduled emails...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 
                  =======================
                  TAB: Report Designer (Merged)
                  ======================= 
                -->
                <div id="report-designer-tab" class="tab-content hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-3xl font-bold text-navy">Report Designer & Scheduler</h1>
                        <button id="design-report-btn" class="px-5 py-2 bg-emerald text-white rounded-lg font-semibold shadow-md hover:bg-opacity-90 transition">
                            <i class="fas fa-plus mr-2"></i>Design New Report
                        </button>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-semibold text-navy mb-4">Scheduled Reports</h2>
                        <p class="text-gray-600 mb-4">Reports designed here will appear in the "Email Scheduling" tab once saved.</p>
                        <!-- Note: The table for "Scheduled Reports" was redundant with "Email Scheduling"
                             This tab now just serves to open the "Design New Report" modal.
                             The results of designing a report are saved to the "scheduled" list. -->
                    </div>
                </div>

            </main>
        </div>
    </div>


    <!-- =================================================================== -->
    <!-- MODALS (Merged from email.html)                                     -->
    <!-- =================================================================== -->

    <!-- Add/Edit Sender Modal -->
    <div id="add-sender-modal" class="hidden fixed inset-0 z-30 bg-black bg-opacity-60 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl transform transition-all" role="dialog">
            <form id="add-sender-form">
                <div class="flex items-center justify-between px-6 py-4 border-b border-gray-200">
                    <h3 class="text-2xl font-semibold text-navy">Add New Sender</h3>
                    <button type="button" class="close-modal-btn text-gray-400 hover:text-gray-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <label for="sender-email" class="block text-sm font-medium text-gray-700">Email Address</label>
                        <input type="email" id="sender-email" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald">
                    </div>
                    <div>
                        <label for="sender-name" class="block text-sm font-medium text-gray-700">Display Name (Optional)</label>
                        <input type="text" id="sender-name" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald">
                    </div>
                    <div>
                        <label for="sender-type" class="block text-sm font-medium text-gray-700">Authentication Type</label>
                        <select id="sender-type" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald">
                            <option value="gmail">Gmail (OAuth)</option>
                            <option value="outlook">Outlook (OAuth)</option>
                            <option value="smtp">SMTP Credentials</option>
                        </select>
                    </div>
                    
                    <!-- OAuth Section -->
                    <div id="oauth-section">
                        <p class="text-sm text-gray-600">OAuth requires a backend server to handle the authentication flow. This form will only save the configuration.</p>
                        <button type="button" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium w-full opacity-50 cursor-not-allowed">
                            <i class="fab fa-google mr-2"></i>Connect with Google (Requires Backend)
                        </button>
                    </div>

                    <!-- SMTP Section -->
                    <div id="smtp-section" class="hidden space-y-4 pt-4 border-t">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="smtp-host" class="block text-sm font-medium text-gray-700">SMTP Host</label>
                                <input type="text" id="smtp-host" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald" placeholder="smtp.example.com">
                            </div>
                            <div>
                                <label for="smtp-port" class="block text-sm font-medium text-gray-700">SMTP Port</label>
                                <input type="number" id="smtp-port" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald" placeholder="587">
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                             <div>
                                <label for="smtp-user" class="block text-sm font-medium text-gray-700">Username</label>
                                <input type="text" id="smtp-user" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald">
                            </div>
                            <div>
                                <label for="smtp-pass" class="block text-sm font-medium text-gray-700">Password / App Password</label>
                                <input type="password" id="smtp-pass" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald">
                            </div>
                        </div>
                        <div>
                            <label for="smtp-tls" class="block text-sm font-medium text-gray-700">Security</label>
                            <select id="smtp-tls" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald">
                                <option value="tls">TLS</option>
                                <option value="ssl">SSL</option>
                                <option value="none">None</option>
                            </select>
                        </div>
                    </div>
                    <p class="text-xs text-red-600 font-medium"><i class="fas fa-exclamation-triangle mr-1"></i> For security, passwords are NOT saved to the database from this form. A backend (e.g., Cloud Function) is required to securely store and use credentials.</p>
                </div>
                <div class="flex items-center justify-end space-x-3 px-6 py-4 bg-gray-50 border-t border-gray-200 rounded-b-xl">
                    <button type="button" class="close-modal-btn px-5 py-2.5 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition font-medium">Cancel</button>
                    <button type="submit" class="px-5 py-2.5 bg-emerald text-white rounded-lg hover:bg-opacity-90 transition font-medium">Save Configuration</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Schedule Email Modal -->
    <div id="schedule-email-modal" class="hidden fixed inset-0 z-30 bg-black bg-opacity-60 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl transform transition-all" role="dialog">
            <form id="schedule-email-form">
                <div class="flex items-center justify-between px-6 py-4 border-b border-gray-200">
                    <h3 class="text-2xl font-semibold text-navy">Schedule New Email</h3>
                    <button type="button" class="close-modal-btn text-gray-400 hover:text-gray-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div class="p-6 space-y-4 max-h-[70vh] overflow-y-auto">
                    <div>
                        <label for="email-sender" class="block text-sm font-medium text-gray-700">Sender</label>
                        <select id="email-sender" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald">
                            <!-- Populated by JS from Firebase senders -->
                            <option value="">Loading senders...</option>
                        </select>
                    </div>
                    <div>
                        <label for="email-recipients" class="block text-sm font-medium text-gray-700">Recipients (comma-separated)</label>
                        <input type="text" id="email-recipients" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald" placeholder="user1@example.com, user2@example.com">
                    </div>
                    <div>
                        <label for="email-subject" class="block text-sm font-medium text-gray-700">Subject</label>
                        <input type="text" id="email-subject" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald">
                    </div>
                    <div>
                        <label for="email-body" class="block text-sm font-medium text-gray-700">Body (HTML or plain text)</label>
                        <textarea id="email-body" rows="10" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald" placeholder="Hello,&#10;&#10;Here is your report."></textarea>
                    </div>
                    <div>
                        <label for="email-attachments" class="block text-sm font-medium text-gray-700">Attachments (PDFs)</label>
                        <input type="file" id="email-attachments" multiple accept=".pdf" class="mt-1 block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-emerald/10 file:text-emerald
                            hover:file:bg-emerald/20">
                        <p class="text-xs text-gray-500 mt-1">Note: File uploads require a backend and Firebase Storage.</p>
                    </div>
                    <div>
                        <label for="email-recurrence" class="block text-sm font-medium text-gray-700">Recurrence</label>
                        <select id="email-recurrence" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald">
                            <option value="one-off">One-off</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="custom">Custom (Cron)</option>
                        </select>
                    </div>
                    <div id="custom-recurrence-section" class="hidden">
                         <label for="email-cron" class="block text-sm font-medium text-gray-700">Cron String</label>
                        <input type="text" id="email-cron" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald" placeholder="* 9 * * 1">
                        <p class="text-xs text-gray-500 mt-1">e.g., "* 9 * * 1" for every Monday at 9am. Uses server timezone.</p>
                    </div>
                </div>
                <div class="flex items-center justify-end space-x-3 px-6 py-4 bg-gray-50 border-t border-gray-200 rounded-b-xl">
                    <button type="button" class="close-modal-btn px-5 py-2.5 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition font-medium">Cancel</button>
                    <button type="submit" class="px-5 py-2.5 bg-emerald text-white rounded-lg hover:bg-opacity-90 transition font-medium">Schedule Email</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Report Designer Modal -->
    <div id="design-report-modal" class="hidden fixed inset-0 z-30 bg-black bg-opacity-60 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl transform transition-all" role="dialog">
            <form id="design-report-form">
                <div class="flex items-center justify-between px-6 py-4 border-b border-gray-200">
                    <h3 class="text-2xl font-semibold text-navy">Design & Schedule Report</h3>
                    <button type="button" class="close-modal-btn text-gray-400 hover:text-gray-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div class="p-6 max-h-[70vh] overflow-y-auto grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Left Side: Filters -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-navy">1. Report Details</h4>
                        <div>
                            <label for="report-name" class="block text-sm font-medium text-gray-700">Report Name (Email Subject)</label>
                            <input type="text" id="report-name" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald" placeholder="e.g., Weekly High-Confidence Picks">
                        </div>
                        <div>
                            <label for="report-body" class="block text-sm font-medium text-gray-700">Email Body</label>
                            <textarea id="report-body" rows="4" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald" placeholder="Here is your weekly report for high-confidence picks."></textarea>
                        </div>
                        
                        <h4 class="text-lg font-semibold text-navy mt-4">2. Data Filters</h4>
                        <div>
                            <label for="report-league" class="block text-sm font-medium text-gray-700">League</label>
                            <select id="report-league" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald">
                                <option value="">All Leagues</option>
                                <!-- Populated by JS -->
                            </select>
                        </div>
                         <div>
                            <label for="report-confidence" class="block text-sm font-medium text-gray-700">Min. Confidence %</label>
                            <input type="number" id="report-confidence" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald" placeholder="e.g., 60">
                        </div>
                    </div>
                    <!-- Right Side: Fields & Schedule -->
                    <div class="space-y-4">
                         <h4 class="text-lg font-semibold text-navy">3. Fields to Include in PDF</h4>
                         <div class="grid grid-cols-2 gap-2 max-h-40 overflow-y-auto p-3 bg-gray-50 rounded-lg border">
                            <!-- Field Checkboxes -->
                            <div><label class="flex items-center"><input type="checkbox" name="report_field" value="Date" class="rounded text-emerald mr-2" checked> Date</label></div>
                            <div><label class="flex items-center"><input type="checkbox" name="report_field" value="Home Team" class="rounded text-emerald mr-2" checked> Home Team</label></div>
                            <div><label class="flex items-center"><input type="checkbox" name="report_field" value="Away Team" class="rounded text-emerald mr-2" checked> Away Team</label></div>
                            <div><label class="flex items-center"><input type="checkbox" name="report_field" value="Odds" class="rounded text-emerald mr-2"> Odds (H/D/A)</label></div>
                            <div><label class="flex items-center"><input type="checkbox" name="report_field" value="Prediction" class="rounded text-emerald mr-2" checked> Prediction</label></div>
                            <div><label class="flex items-center"><input type="checkbox" name="report_field" value="Confidence" class="rounded text-emerald mr-2" checked> Confidence %</label></div>
                            <div><label class="flex items-center"><input type="checkbox" name="report_field" value="Pred. Outcome" class="rounded text-emerald mr-2"> Pred. Outcome</label></div>
                            <div><label class="flex items-center"><input type="checkbox" name="report_field" value="Pred. Prob." class="rounded text-emerald mr-2"> Pred. Prob. %</label></div>
                            <div><label class="flex items-center"><input type="checkbox" name="report_field" value="Exp. Outcome" class="rounded text-emerald mr-2"> Exp. Outcome</label></div>
                            <div><label class="flex items-center"><input type="checkbox" name="report_field" value="Prob. Rate" class="rounded text-emerald mr-2"> Prob. Rate</label></div>
                            <div><label class="flex items-center"><input type="checkbox" name="report_field" value="Match Result" class="rounded text-emerald mr-2"> Match Result</label></div>
                            <div><label class="flex items-center"><input type="checkbox" name="report_field" value="Total Goals" class="rounded text-emerald mr-2"> Total Goals</label></div>
                         </div>
                         <p class="text-xs text-gray-500">Note: PDF Generation requires a backend (e.g., Cloud Function with Puppeteer or jspdf). This will save the *request*.</p>
                         
                         <h4 class="text-lg font-semibold text-navy mt-4">4. Schedule & Recipients</h4>
                         <div>
                            <label for="report-sender" class="block text-sm font-medium text-gray-700">Sender</label>
                            <select id="report-sender" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald">
                                <!-- Populated by JS from Firebase senders -->
                                <option value="">Loading senders...</option>
                            </select>
                        </div>
                         <div>
                            <label for="report-email-recipients" class="block text-sm font-medium text-gray-700">Recipients (comma-separated)</label>
                            <input type="text" id="report-email-recipients" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald" placeholder="team@example.com">
                        </div>
                        <div>
                            <label for="report-recurrence" class="block text-sm font-medium text-gray-700">Recurrence</pre>
                            <select id="report-recurrence" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-emerald focus:ring-emerald">
                                <option value="one-off">One-off (Run Now)</option>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="custom">Custom (Cron)</option>
                            </select>
                        </div>
                    </div>
                </div>
                 
                <div class="flex items-center justify-end space-x-3 px-6 py-4 bg-gray-50 border-t border-gray-200 rounded-b-xl">
                    <button type="button" class="close-modal-btn px-5 py-2.5 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition font-medium">Cancel</button>
                    <button type="submit" class="px-5 py-2.5 bg-emerald text-white rounded-lg hover:bg-opacity-90 transition font-medium">Save & Schedule Report</button>
                </div>
            </form>
        </div>
    </div>


    <!-- =================================================================== -->
    <!-- JAVASCRIPT (MERGED & UPDATED WITH FIREBASE)                         -->
    <!-- =================================S================================== -->
    <script type="module">
        // -------------------------------------------
        // FIREBASE IMPORTS (From Instructions)
        // -------------------------------------------
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
        // --- FIX: Replaced 'onSnapshot' with 'onValue' ---
        import { getDatabase, ref, set, push, get, update, remove, onValue } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";

        // -------------------------------------------
        // FIREBASE CONFIG (From Instructions)
        // -------------------------------------------
        // IMPORTANT: Replace placeholders with your actual Firebase project settings
        const firebaseConfig = {
          apiKey: "YOUR_API_KEY", // Get this from your Firebase project settings
          authDomain: "datacompass360-3b5d9.firebaseapp.com",
          databaseURL: "https://datacompass360-3b5d9-default-rtdb.firebaseio.com/", // This matches your instructions
          projectId: "datacompass360-3b5d9",
          storageBucket: "datacompass360-3b5d9.appspot.com",
          messagingSenderId: "YOUR_SENDER_ID", // Get this from Firebase
          appId: "YOUR_APP_ID" // Get this from Firebase
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        
        // -------------------------------------------
        // CONFIG
        // -------------------------------------------
        
        const GOOGLE_SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT9E7TTXJgBm3CBY0Oydz5qQ_QLaP-8Za5O2GSitCWFvOSI9tt-nEaSS64P7NPX6h6aJluZ4bA16nIO/pub?gid=0&single=true&output=csv';
        
        // Hot Picks Config
        const ROWS_PER_PAGE = 10;
        const FREQUENT_WINNER_MIN_APPEARANCES = 3;
        const FREQUENT_WINNER_MIN_WINS = 3;
        const OVER_2_5_HTEAM_SCORED = 1.8;
        const OVER_2_5_ATEAM_SCORED = 1.8;
        const OVER_2_5_HTEAM_CONCEDED = 1.5;
        const OVER_2_5_ATEAM_CONCEDED = 1.5;


        // -------------------------------------------
        // STATE (Merged)
        // -------------------------------------------
        
        // Hot Picks State
        let allData = [];
        let uniqueDates = new Set();
        let uniqueLeagues = new Set();
        let frequentWinnerTeams = [];
        
        let table1FilteredData = [];
        let table2FilteredData = [];
        
        let table1CurrentPage = 1;
        let table2CurrentPage = 1;

        // -------------------------------------------
        // DOM Element Cache (Merged)
        // -------------------------------------------
        const dom = {
            navTabButtons: document.querySelectorAll('.nav-tab-button'),
            tabContents: document.querySelectorAll('.tab-content'),
            notification: {
                popup: document.getElementById('notification-popup'),
                message: document.getElementById('notification-message'),
            },
            // Modals
            modals: {
                addSender: document.getElementById('add-sender-modal'),
                scheduleEmail: document.getElementById('schedule-email-modal'),
                designReport: document.getElementById('design-report-modal'),
            },
            // Buttons
            buttons: {
                addEmail: document.getElementById('add-email-btn'),
                scheduleEmail: document.getElementById('schedule-email-btn'),
                designReport: document.getElementById('design-report-btn'),
                closeModal: document.querySelectorAll('.close-modal-btn'),
            },
            // Forms
            forms: {
                addSender: document.getElementById('add-sender-form'),
                scheduleEmail: document.getElementById('schedule-email-form'),
                designReport: document.getElementById('design-report-form'),
            },
            // Form Controls
            senderType: document.getElementById('sender-type'),
            oauthSection: document.getElementById('oauth-section'),
            smtpSection: document.getElementById('smtp-section'),
            emailRecurrence: document.getElementById('email-recurrence'),
            customRecurrence: document.getElementById('custom-recurrence-section'),
            
            // Table 1 (from hot-picks)
            table1: {
                loader: document.getElementById('table-1-loader'),
                wrapper: document.getElementById('table-1-wrapper'),
                dateFilter: document.getElementById('date-filter-1'),
                leagueFilter: document.getElementById('league-filter-1'),
                tbody: document.getElementById('frequent-winners-tbody'),
                prevBtn: document.getElementById('prev-btn-1'),
                nextBtn: document.getElementById('next-btn-1'),
                pageInfo: document.getElementById('page-info-1'),
            },
            // Table 2 (from hot-picks)
            table2: {
                loader: document.getElementById('table-2-loader'),
                wrapper: document.getElementById('table-2-wrapper'),
                dateFilter: document.getElementById('date-filter-2'),
                leagueFilter: document.getElementById('league-filter-2'),
                tbody: document.getElementById('over-2-5-tbody'),
                prevBtn: document.getElementById('prev-btn-2'),
                nextBtn: document.getElementById('next-btn-2'),
                pageInfo: document.getElementById('page-info-2'),
            },
            // Email Integration Tables
            sendersTableBody: document.getElementById('senders-table-body'),
            schedulingTableBody: document.getElementById('scheduling-table-body'),
            
            // Email Integration Selects
            emailSenderSelect: document.getElementById('email-sender'),
            reportSenderSelect: document.getElementById('report-sender'),
            reportLeagueFilter: document.getElementById('report-league'),
        };

        // -------------------------------------------
        // UTILITY FUNCTIONS (Merged)
        // -------------------------------------------

        function showNotification(message, type = 'info') {
            const popup = dom.notification.popup;
            dom.notification.message.textContent = message;
            popup.classList.remove('bg-emerald', 'bg-red-500', 'bg-blue-500', 'hidden');
            if (type === 'success') popup.classList.add('bg-emerald');
            else if (type === 'error') popup.classList.add('bg-red-500');
            else popup.classList.add('bg-blue-500');
            popup.classList.remove('hidden');
            setTimeout(() => popup.classList.add('hidden'), 3000);
        }

        /**
         * Parses a match result string (e.g., "2-1") and determines the winner.
         * @param {string} resultString - The match result.
         * @returns {'home' | 'away' | 'draw' | null} - The winner.
         */
        function getWinnerFromScore(resultString) {
            if (!resultString || typeof resultString !== 'string') return null;
            const scores = resultString.split('-').map(s => parseInt(s.trim(), 10));
            if (scores.length === 2 && !isNaN(scores[0]) && !isNaN(scores[1])) {
                if (scores[0] > scores[1]) return 'home';
                if (scores[1] > scores[0]) return 'away';
                if (scores[0] === scores[1]) return 'draw';
            }
            return null;
        }
        
        /**
         * Parses a match result string (e.g., "2-1") and calculates total goals.
         * @param {string} resultString - The match result.
         * @returns {number | 'â€”'} - The total goals or 'â€”'.
         */
        function calculateTotalGoals(resultString) {
            if (!resultString || typeof resultString !== 'string') return 'â€”';
            const scores = resultString.split('-').map(s => parseInt(s.trim(), 10));
            if (scores.length === 2 && !isNaN(scores[0]) && !isNaN(scores[1])) {
                return scores[0] + scores[1];
            }
            return 'â€”';
        }

        /**
         * Sanitizes and formats a value for display in a table.
         * @param {string | number | undefined} value - The value from the data.
         * @returns {string} - The formatted value.
         */
        function formatCell(value) {
            if (value === undefined || value === null || value === '') {
                return 'â€”';
            }
            return String(value);
        }
        
        // -------------------------------------------
        // NAVIGATION (from email)
        // -------------------------------------------
        
        function switchTab(tabName) {
            dom.tabContents.forEach(content => content.classList.add('hidden'));
            dom.navTabButtons.forEach(button => button.classList.remove('active'));

            const activeContent = document.getElementById(`${tabName}-tab`);
            const activeButton = document.querySelector(`.nav-tab-button[data-tab="${tabName}"]`);
            
            if (activeContent) activeContent.classList.remove('hidden');
            if (activeButton) activeButton.classList.add('active');
        }

        // -------------------------------------------
        // DATA FETCHING & PROCESSING (from hot-picks)
        // -------------------------------------------

        /**
         * Fetches and parses the CSV data from the Google Sheet.
         */
        async function fetchData() {
            try {
                if (!GOOGLE_SHEET_CSV_URL || GOOGLE_SHEET_CSV_URL.includes('S-H-O-L-D-E-R')) {
                    showNotification('Error: Google Sheet URL is not set. Please update the script.', 'error');
                    dom.table1.loader.classList.add('hidden');
                    dom.table2.loader.classList.add('hidden');
                    return;
                }
                
                Papa.parse(GOOGLE_SHEET_CSV_URL, {
                    download: true,
                    header: true,
                    skipEmptyLines: true,
                    complete: (results) => {
                        allData = results.data;
                        processData();
                        populateFilters();
                        renderTable1();
                        renderTable2();
                        dom.table1.loader.classList.add('hidden');
                        dom.table1.wrapper.classList.remove('hidden');
                        dom.table2.loader.classList.add('hidden');
                        dom.table2.wrapper.classList.remove('hidden');
                        showNotification('Data loaded successfully!', 'success');
                    },
                    error: (err) => {
                        showNotification(`Error fetching data: ${err.message}`, 'error');
                        dom.table1.loader.classList.add('hidden');
                        dom.table2.loader.classList.add('hidden');
                    }
                });
            } catch (error) {
                showNotification(`Error: ${error.message}`, 'error');
                dom.table1.loader.classList.add('hidden');
                dom.table2.loader.classList.add('hidden');
            }
        }

        /**
         * Processes the raw data to find unique filters and frequent winners.
         */
        function processData() {
            const teamStats = {};

            allData.forEach(row => {
                const homeTeam = row['Home Team'];
                const awayTeam = row['Away Team'];
                
                // Populate filters
                if (row['Date']) uniqueDates.add(row['Date']);
                if (row['League']) uniqueLeagues.add(row['League']);

                // Initialize team stats if not present
                if (homeTeam) {
                    if (!teamStats[homeTeam]) teamStats[homeTeam] = { appearances: 0, wins: 0 };
                    teamStats[homeTeam].appearances++;
                }
                if (awayTeam) {
                    if (!teamStats[awayTeam]) teamStats[awayTeam] = { appearances: 0, wins: 0 };
                    teamStats[awayTeam].appearances++;
                }

                // Calculate wins
                const winner = getWinnerFromScore(row['Match Result']);
                if (winner === 'home' && homeTeam) {
                    teamStats[homeTeam].wins++;
                } else if (winner === 'away' && awayTeam) {
                    teamStats[awayTeam].wins++;
                }
            });

            // Determine the set of frequent winner teams
            frequentWinnerTeams = Object.keys(teamStats).filter(team => 
                teamStats[team].appearances > FREQUENT_WINNER_MIN_APPEARANCES && 
                teamStats[team].wins >= FREQUENT_WINNER_MIN_WINS
            );
        }

        /**
         * Populates the filter dropdowns with unique, sorted values.
         */
        function populateFilters() {
            // Sort dates (newest to oldest)
            const sortedDates = [...uniqueDates].sort((a, b) => new Date(b) - new Date(a));
            // Sort leagues (A-Z)
            const sortedLeagues = [...uniqueLeagues].sort();

            const dateOptions = sortedDates.map(date => `<option value="${date}">${date}</option>`).join('');
            const leagueOptions = sortedLeagues.map(league => `<option value="${league}">${league}</option>`).join('');

            dom.table1.dateFilter.innerHTML += dateOptions;
            dom.table1.leagueFilter.innerHTML += leagueOptions;
            dom.table2.dateFilter.innerHTML += dateOptions;
            dom.table2.leagueFilter.innerHTML += leagueOptions;
            
            // Also populate report designer league dropdown
            if (dom.reportLeagueFilter) {
                dom.reportLeagueFilter.innerHTML += leagueOptions;
            }
        }

        // -------------------------------------------
        // TABLE 1: FREQUENT WINNERS (from hot-picks)
        // -------------------------------------------

        function renderTable1() {
            const dateFilter = dom.table1.dateFilter.value;
            const leagueFilter = dom.table1.leagueFilter.value;

            // 1. Apply Filters
            table1FilteredData = allData.filter(row => {
                const matchesTeam = frequentWinnerTeams.includes(row['Home Team']) || frequentWinnerTeams.includes(row['Away Team']);
                const matchesDate = !dateFilter || row['Date'] === dateFilter;
                const matchesLeague = !leagueFilter || row['League'] === leagueFilter;
                return matchesTeam && matchesDate && matchesLeague;
            });

            // 2. Apply Pagination
            const totalPages = Math.ceil(table1FilteredData.length / ROWS_PER_PAGE);
            if (table1CurrentPage > totalPages) table1CurrentPage = 1;
            if (table1CurrentPage < 1) table1CurrentPage = 1;
            
            const startIndex = (table1CurrentPage - 1) * ROWS_PER_PAGE;
            const endIndex = startIndex + ROWS_PER_PAGE;
            const paginatedData = table1FilteredData.slice(startIndex, endIndex);

            // 3. Generate HTML
            let html = '';
            if (paginatedData.length === 0) {
                // Updated colspan to 9
                html = '<tr><td colspan="9" class="text-center py-4 text-gray-500">No matches found for the selected criteria.</td></tr>';
            } else {
                paginatedData.forEach(row => {
                    // Updated row template
                    html += `
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Confidence %'])}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Prediction'])}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Predicted Outcome'])}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Match Result'])}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Home Team'])}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Away Team'])}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Predicted Probability (%)'])}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Expected Outcome'])}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Probability'])}</td>
                        </tr>
                    `;
                });
            }
            dom.table1.tbody.innerHTML = html;

            // 4. Update Pagination UI
            dom.table1.pageInfo.textContent = `Page ${table1CurrentPage} of ${totalPages || 1}`;
            dom.table1.prevBtn.disabled = table1CurrentPage === 1;
            dom.table1.nextBtn.disabled = table1CurrentPage === totalPages || totalPages === 0;
        }

        // -------------------------------------------
        // TABLE 2: OVER 2.5 PREDICTION (from hot-picks)
        // -------------------------------------------

        function renderTable2() {
            const dateFilter = dom.table2.dateFilter.value;
            const leagueFilter = dom.table2.leagueFilter.value;

            // 1. Apply Filters
            table2FilteredData = allData.filter(row => {
                const hTeamScored = parseFloat(row['Hteam Avg Scored']);
                const aTeamScored = parseFloat(row['Ateam Avg Scored']);
                const hTeamConceded = parseFloat(row['Hteam Avg Conceded']);
                const aTeamConceded = parseFloat(row['Ateam Avg Conceded']);

                const matchesStats = hTeamScored >= OVER_2_5_HTEAM_SCORED &&
                                     aTeamScored >= OVER_2_5_ATEAM_SCORED &&
                                     hTeamConceded >= OVER_2_5_HTEAM_CONCEDED &&
                                     aTeamConceded >= OVER_2_5_ATEAM_CONCEDED;
                
                const matchesDate = !dateFilter || row['Date'] === dateFilter;
                const matchesLeague = !leagueFilter || row['League'] === leagueFilter;
                
                return matchesStats && matchesDate && matchesLeague;
            });

            // 2. Apply Pagination
            const totalPages = Math.ceil(table2FilteredData.length / ROWS_PER_PAGE);
            if (table2CurrentPage > totalPages) table2CurrentPage = 1;
            if (table2CurrentPage < 1) table2CurrentPage = 1;

            const startIndex = (table2CurrentPage - 1) * ROWS_PER_PAGE;
            const endIndex = startIndex + ROWS_PER_PAGE;
            const paginatedData = table2FilteredData.slice(startIndex, endIndex);

            // 3. Generate HTML
            let html = '';
            if (paginatedData.length === 0) {
                // Updated colspan to 14
                html = '<tr><td colspan="14" class="text-center py-4 text-gray-500">No matches found for the selected criteria.</td></tr>';
            } else {
                paginatedData.forEach(row => {
                    const totalGoals = calculateTotalGoals(row['Match Result']);
                    const rowClass = totalGoals >= 3 ? 'bg-green-100 hover:bg-green-200' : 'hover:bg-gray-50';
                    
                    // Updated row template
                    html += `
                        <tr class="${rowClass}">
                            <td class="px-2 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Hteam Avg Scored'])}</td>
                            <td class="px-2 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Hteam Avg Conceded'])}</td>
                            <td class="px-2 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Ateam Avg Scored'])}</td>
                            <td class="px-2 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Ateam Avg Conceded'])}</td>
                            <td class="px-2 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Home Team'])}</td>
                            <td class="px-2 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Away Team'])}</td>
                            <td class="px-2 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Confidence %'])}</td>
                            <td class="px-2 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Prediction'])}</td>
                            <td class="px-2 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Predicted Outcome'])}</td>
                            <td class="px-2 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Predicted Probability (%)'])}</td>
                            <td class="px-2 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Match Result'])}</td>
                            <td class="px-2 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Expected Outcome'])}</td>
                            <td class="px-2 py-3 whitespace-nowrap text-sm text-gray-900">${formatCell(row['Probability'])}</td>
                            <td class="px-2 py-3 whitespace-nowrap text-sm font-bold ${totalGoals >= 3 ? 'text-green-800' : 'text-gray-900'}">${totalGoals}</td>
                        </tr>
                    `;
                });
            }
            dom.table2.tbody.innerHTML = html;

            // 4. Update Pagination UI
            dom.table2.pageInfo.textContent = `Page ${table2CurrentPage} of ${totalPages || 1}`;
            dom.table2.prevBtn.disabled = table2CurrentPage === 1;
            dom.table2.nextBtn.disabled = table2CurrentPage === totalPages || totalPages === 0;
        }

        // -------------------------------------------
        // FIREBASE: RENDER SENDER TABLE (NEW)
        // -------------------------------------------
        function renderSendersTable(senders) {
            let html = '';
            let senderOptions = '<option value="">Select a sender...</option>';

            if (!senders || Object.keys(senders).length === 0) {
                html = '<tr><td colspan="5" class="text-center py-4 text-gray-500">No senders configured. Add one to get started.</td></tr>';
                senderOptions = '<option value="">No senders available</option>';
            } else {
                for (const id in senders) {
                    const sender = senders[id];
                    html += `
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${sender.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                    ${sender.status || 'Pending'}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${formatCell(sender.email)}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCell(sender.name)}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCell(sender.type)}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-3">
                                <button class="text-red-600 hover:text-red-800 delete-sender-btn" data-id="${id}">Delete</button>
                            </td>
                        </tr>
                    `;
                    senderOptions += `<option value="${id}">${sender.name || sender.email} (${sender.email})</option>`;
                }
            }
            dom.sendersTableBody.innerHTML = html;
            dom.emailSenderSelect.innerHTML = senderOptions;
            dom.reportSenderSelect.innerHTML = senderOptions;
        }

        // -------------------------------------------
        // FIREBASE: RENDER SCHEDULE TABLE (NEW)
        // -------------------------------------------
        function renderScheduledTable(schedules) {
            let html = '';
            if (!schedules || Object.keys(schedules).length === 0) {
                html = '<tr><td colspan="6" class="text-center py-4 text-gray-500">No emails scheduled.</td></tr>';
            } else {
                 for (const id in schedules) {
                    const job = schedules[id];
                    html += `
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                                    ${job.status || 'Pending'}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${formatCell(job.subject)}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCell(job.recipients)}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCell(job.recurrence)}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${job.recurrence === 'one-off' ? 'Once' : 'Recurring'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-3">
                                <button class="text-red-600 hover:text-red-800 delete-schedule-btn" data-id="${id}">Delete</button>
                            </td>
                        </tr>
                    `;
                }
            }
            dom.schedulingTableBody.innerHTML = html;
        }

        
        // -------------------------------------------
        // EVENT LISTENERS (Merged & Updated)
        // -------------------------------------------

        // --- Tab Navigation ---
        dom.navTabButtons.forEach(button => {
            button.addEventListener('click', () => {
                switchTab(button.dataset.tab);
            });
        });

        // --- Modal & Form Logic (from email) ---
        // Open Modals
        if (dom.buttons.addEmail) {
            dom.buttons.addEmail.addEventListener('click', () => dom.modals.addSender.classList.remove('hidden'));
        }
        if (dom.buttons.scheduleEmail) {
            dom.buttons.scheduleEmail.addEventListener('click', () => dom.modals.scheduleEmail.classList.remove('hidden'));
        }
        if (dom.buttons.designReport) {
            dom.buttons.designReport.addEventListener('click', () => dom.modals.designReport.classList.remove('hidden'));
        }
        // Close Modals
        dom.buttons.closeModal.forEach(button => {
            button.addEventListener('click', () => {
                button.closest('.fixed').classList.add('hidden');
            });
        });
        // Toggle Sender Auth Type
        if (dom.senderType) {
            dom.senderType.addEventListener('change', (e) => {
                if (e.target.value === 'smtp') {
                    dom.oauthSection.classList.add('hidden');
                    dom.smtpSection.classList.remove('hidden');
                } else {
                    dom.oauthSection.classList.remove('hidden');
                    dom.smtpSection.classList.add('hidden');
                    if (e.target.value === 'gmail') {
                        dom.oauthSection.querySelector('button').innerHTML = '<i class="fab fa-google mr-2"></i>Connect with Google (Requires Backend)';
                    } else {
                        dom.oauthSection.querySelector('button').innerHTML = '<i class="fab fa-microsoft mr-2"></i>Connect with Outlook (Requires Backend)';
                    }
                }
            });
        }
        // Toggle Custom Recurrence
        if (dom.emailRecurrence) {
            dom.emailRecurrence.addEventListener('change', (e) => {
                if (e.target.value === 'custom') {
                    dom.customRecurrence.classList.remove('hidden');
                } else {
                    dom.customRecurrence.classList.add('hidden');
                }
            });
        }

        // --- Form Submissions (UPDATED with Firebase) ---

        // Add Sender Form
        if(dom.forms.addSender) {
            dom.forms.addSender.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('sender-email').value;
                const name = document.getElementById('sender-name').value;
                const type = document.getElementById('sender-type').value;
                
                const senderData = {
                    email: email,
                    name: name,
                    type: type,
                    status: "pending", // Default status
                    lastTest: new Date().toISOString()
                };

                if (type === 'smtp') {
                    senderData.smtp = {
                        host: document.getElementById('smtp-host').value,
                        port: document.getElementById('smtp-port').value,
                        user: document.getElementById('smtp-user').value,
                        security: document.getElementById('smtp-tls').value,
                        // WARNING: Do not save password to DB from client
                    };
                }

                try {
                    // Save to Firebase at /emails/senders/
                    await push(ref(db, 'emails/senders'), senderData);
                    showNotification(`Sender ${email} configuration saved.`, 'success');
                    dom.forms.addSender.reset();
                    dom.modals.addSender.classList.add('hidden');
                } catch (error) {
                    console.error("Error saving sender: ", error);
                    showNotification(`Error saving sender: ${error.message}`, 'error');
                }
            });
        }

        // Schedule Email Form
        if(dom.forms.scheduleEmail) {
            dom.forms.scheduleEmail.addEventListener('submit', async (e) => {
                e.preventDefault();
                const senderId = document.getElementById('email-sender').value;
                const recipients = document.getElementById('email-recipients').value;
                const subject = document.getElementById('email-subject').value;
                const body = document.getElementById('email-body').value;
                let recurrence = document.getElementById('email-recurrence').value;

                if (recurrence === 'custom') {
                    recurrence = document.getElementById('email-cron').value;
                }
                
                const scheduleData = {
                    senderId: senderId,
                    recipients: recipients,
                    subject: subject,
                    body: body,
                    recurrence: recurrence,
                    status: "pending",
                    createdAt: new Date().toISOString()
                    // Note: Attachment handling requires Firebase Storage & backend logic
                };

                try {
                    // Save to Firebase at /emails/scheduled/
                    await push(ref(db, 'emails/scheduled'), scheduleData);
                    showNotification(`Email "${subject}" scheduled successfully.`, 'success');
                    dom.forms.scheduleEmail.reset();
                    dom.modals.scheduleEmail.classList.add('hidden');
                } catch (error) {
                    console.error("Error scheduling email: ", error);
                    showNotification(`Error scheduling email: ${error.message}`, 'error');
                }
            });
        }
        
        // Design Report Form
        if(dom.forms.designReport) {
            dom.forms.designReport.addEventListener('submit', async (e) => {
                e.preventDefault();

                // Get all selected fields
                const fields = [];
                document.querySelectorAll('input[name="report_field"]:checked').forEach((checkbox) => {
                    fields.push(checkbox.value);
                });

                const reportJob = {
                    type: "report", // Differentiate from simple email
                    senderId: document.getElementById('report-sender').value,
                    recipients: document.getElementById('report-email-recipients').value,
                    subject: document.getElementById('report-name').value,
                    body: document.getElementById('report-body').value,
                    recurrence: document.getElementById('report-recurrence').value,
                    status: "pending",
                    createdAt: new Date().toISOString(),
                    reportConfig: {
                        league: document.getElementById('report-league').value,
                        minConfidence: document.getElementById('report-confidence').value,
                        fields: fields
                    }
                };
                
                try {
                    // Save to Firebase at /emails/scheduled/
                    await push(ref(db, 'emails/scheduled'), reportJob);
                    showNotification(`Report "${reportJob.subject}" scheduled successfully.`, 'success');
                    dom.forms.designReport.reset();
                    dom.modals.designReport.classList.add('hidden');
                } catch (error) {
                    console.error("Error scheduling report: ", error);
                    showNotification(`Error scheduling report: ${error.message}`, 'error');
                }
            });
        }

        // --- Table 1 Listeners (from hot-picks) ---
        dom.table1.dateFilter.addEventListener('change', () => {
            table1CurrentPage = 1;
            renderTable1();
        });
        dom.table1.leagueFilter.addEventListener('change', () => {
            table1CurrentPage = 1;
            renderTable1();
        });
        dom.table1.prevBtn.addEventListener('click', () => {
            if (table1CurrentPage > 1) {
                table1CurrentPage--;
                renderTable1();
            }
        });
        dom.table1.nextBtn.addEventListener('click', () => {
            const totalPages = Math.ceil(table1FilteredData.length / ROWS_PER_PAGE);
            if (table1CurrentPage < totalPages) {
                table1CurrentPage++;
                renderTable1();
            }
        });

        // --- Table 2 Listeners (from hot-picks) ---
        dom.table2.dateFilter.addEventListener('change', () => {
            table2CurrentPage = 1;
            renderTable2();
        });
        dom.table2.leagueFilter.addEventListener('change', () => {
            table2CurrentPage = 1;
            renderTable2();
        });
        dom.table2.prevBtn.addEventListener('click', () => {
            if (table2CurrentPage > 1) {
                table2CurrentPage--;
                renderTable2();
            }
        });
        dom.table2.nextBtn.addEventListener('click', () => {
            const totalPages = Math.ceil(table2FilteredData.length / ROWS_PER_PAGE);
            if (table2CurrentPage < totalPages) {
                table2CurrentPage++;
                renderTable2();
            }
        });

        // --- FIREBASE DELETE LISTENERS (NEW) ---
        
        // Delete Sender
        dom.sendersTableBody.addEventListener('click', async (e) => {
            if (e.target.classList.contains('delete-sender-btn')) {
                const id = e.target.dataset.id;
                if (id) {
                    try {
                        await remove(ref(db, `emails/senders/${id}`));
                        showNotification('Sender deleted successfully.', 'success');
                    } catch (error) {
                        showNotification(`Error deleting sender: ${error.message}`, 'error');
                    }
                }
            }
        });

        // Delete Schedule
        dom.schedulingTableBody.addEventListener('click', async (e) => {
            if (e.target.classList.contains('delete-schedule-btn')) {
                const id = e.target.dataset.id;
                if (id) {
                    try {
                        await remove(ref(db, `emails/scheduled/${id}`));
                        showNotification('Scheduled item deleted.', 'success');
                    } catch (error) {
                        showNotification(`Error deleting item: ${error.message}`, 'error');
                    }
                }
            }
        });
        
        // -------------------------------------------
        // INITIALIZATION (Merged & Updated)
        // -------------------------------------------
        
        // Set default tab on page load
        switchTab('hot-picks');
        
        // Trigger change event to set initial auth UI (for email tab)
        if(dom.senderType) {
            dom.senderType.dispatchEvent(new Event('change'));
        }

        // Load data for Hot Picks tables
        fetchData();

        // --- FIREBASE REALTIME LISTENERS (NEW) ---
        try {
            // Listen for senders
            const sendersRef = ref(db, 'emails/senders');
            // --- FIX: Replaced 'onSnapshot' with 'onValue' ---
            onValue(sendersRef, (snapshot) => {
                const data = snapshot.val();
                renderSendersTable(data);
            });

            // Listen for schedules
            const scheduledRef = ref(db, 'emails/scheduled');
            // --- FIX: Replaced 'onSnapshot' with 'onValue' ---
            onValue(scheduledRef, (snapshot) => {
                const data = snapshot.val();
                renderScheduledTable(data);
            });
        } catch (error) {
            showNotification('Error connecting to Firebase. Check your config and API key.', 'error');
            console.error("Firebase connection error:", error);
        }
        
    </script>
</body>
</html>

